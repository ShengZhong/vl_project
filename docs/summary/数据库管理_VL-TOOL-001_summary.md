# é¡¹ç›®æ€»ç»“ - æ•°æ®åº“ç®¡ç†

> **åŠŸèƒ½ç‚¹ID**: VL-TOOL-001  
> **åŠŸèƒ½åç§°**: æ•°æ®åº“ç®¡ç†  
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-15  
> **å®ŒæˆçŠ¶æ€**: âœ… å¼€å‘å®Œæˆ

---

## ğŸ“ åŠŸèƒ½æ¦‚è¿°

ä¸ºç®¡ç†å‘˜å’Œç ”å‘äººå‘˜æä¾›å¯è§†åŒ–çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæŸ¥çœ‹æ•°æ®åº“è¡¨ç»“æ„ã€è¡¨å…³ç³»ã€æ‰§è¡Œè‡ªå®šä¹‰SQLæŸ¥è¯¢ã€‚

**æ‰€å±æ¨¡å—**: å·¥å…·ç±» > æ•°æ®åº“ç®¡ç†

---

## ğŸ¯ åŠŸèƒ½ç‚¹å®ç°æƒ…å†µ

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| **è¡¨ç»“æ„æŸ¥çœ‹** | âœ… å·²å®Œæˆ | æŸ¥çœ‹æ‰€æœ‰è¡¨çš„å­—æ®µã€ç±»å‹ã€çº¦æŸ |
| **è¡¨å…³ç³»æŸ¥çœ‹** | âœ… å·²å®Œæˆ | æŸ¥çœ‹å¤–é”®å…³ç³»å’Œçº§è”è§„åˆ™ |
| **SQLæŸ¥è¯¢** | âœ… å·²å®Œæˆ | æ‰§è¡Œè‡ªå®šä¹‰SQLæŸ¥è¯¢ |
| **æŸ¥è¯¢ç»“æœå¯¼å‡º** | âœ… å·²å®Œæˆ | å¯¼å‡ºæŸ¥è¯¢ç»“æœä¸ºCSV |
| **å±é™©æ“ä½œä¿æŠ¤** | âœ… å·²å®Œæˆ | UPDATE/DELETEéœ€äºŒæ¬¡ç¡®è®¤ï¼Œç¦æ­¢DDLæ“ä½œ |

---

## ğŸ“‚ äº¤ä»˜ç‰©æ¸…å•

### 1. PRD æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ | çŠ¶æ€ |
|-----|------|------|
| **PRDä¸»æ–‡æ¡£** | `docs/prd/PRD_æ•°æ®åº“ç®¡ç†.md` | âœ… å·²å®Œæˆ |
| **é¡¹ç›®æ€»ç»“** | `docs/summary/æ•°æ®åº“ç®¡ç†_VL-TOOL-001_summary.md` | âœ… å·²å®Œæˆ |

### 2. å‰ç«¯åŸå‹ä»£ç 

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| **ä¸»é¡µé¢** | `src/pages/tools/database/index.tsx` | æ•°æ®åº“ç®¡ç†ä¸»é¡µé¢ |
| **æ ·å¼æ–‡ä»¶** | `src/pages/tools/database/index.less` | é¡µé¢æ ·å¼ |
| **è¡¨ç»“æ„ç»„ä»¶** | `src/pages/tools/database/components/TableSchema.tsx` | è¡¨ç»“æ„å±•ç¤º |
| **è¡¨å…³ç³»ç»„ä»¶** | `src/pages/tools/database/components/TableRelations.tsx` | å¤–é”®å…³ç³»å±•ç¤º |
| **SQLæŸ¥è¯¢ç»„ä»¶** | `src/pages/tools/database/components/SQLQuery.tsx` | SQLç¼–è¾‘å™¨å’ŒæŸ¥è¯¢ |

### 3. æœåŠ¡å±‚ä¸ç±»å‹å®šä¹‰

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| **ç±»å‹å®šä¹‰** | `src/types/database.ts` | TypeScript ç±»å‹å®šä¹‰ |
| **æœåŠ¡å±‚** | `src/services/database.ts` | API æœåŠ¡ |

### 4. æ•°æ®åº“å·¥å…·å‡½æ•°

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| **æ•°æ®åº“å·¥å…·** | `src/db/index.ts` | æ–°å¢å·¥å…·å‡½æ•°ï¼ˆ`getAllTableNames`, `getTableStructure`, `getAllTableRelationships`, `executeSQLQuery`ï¼‰|

### 5. Mock æ•°æ®

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| **Mockæ–‡ä»¶** | `mock/database.ts` | Mock APIæ¥å£ |

### 6. è·¯ç”±é…ç½®

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| **è·¯ç”±é…ç½®** | `.umirc.ts` | æ·»åŠ  `/tools/database` è·¯ç”± |

---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### æ•°æ®åº“å·¥å…·å‡½æ•°

1. **getAllTableNames()** - è·å–æ‰€æœ‰è¡¨å
   - ä½¿ç”¨ `sqlite_master` æŸ¥è¯¢ç³»ç»Ÿè¡¨
   - æ’é™¤ SQLite å†…éƒ¨è¡¨

2. **getTableStructure()** - è·å–è¡¨ç»“æ„
   - ä½¿ç”¨ `PRAGMA table_info()` è·å–å­—æ®µä¿¡æ¯
   - è¿”å›å­—æ®µåã€ç±»å‹ã€çº¦æŸç­‰

3. **getAllTableRelationships()** - è·å–è¡¨å…³ç³»
   - ä½¿ç”¨ `PRAGMA foreign_key_list()` è·å–å¤–é”®ä¿¡æ¯
   - éå†æ‰€æœ‰è¡¨ï¼Œæ”¶é›†å¤–é”®å…³ç³»

4. **executeSQLQuery()** - æ‰§è¡ŒSQLæŸ¥è¯¢
   - å®‰å…¨æ£€æŸ¥ï¼šç¦æ­¢ DROP/ALTER ç­‰DDLæ“ä½œ
   - ä¿®æ”¹æ“ä½œï¼ˆUPDATE/DELETE/INSERTï¼‰æ ‡è®°
   - è®°å½•æ‰§è¡Œæ—¶é—´
   - ä¿®æ”¹æ“ä½œåè‡ªåŠ¨ä¿å­˜æ•°æ®åº“

### å‰ç«¯å®ç°

1. **Tabé¡µåˆ‡æ¢**
   - ä½¿ç”¨ Ant Design Tabs ç»„ä»¶
   - ä¸‰ä¸ªTabï¼šè¡¨ç»“æ„ã€è¡¨å…³ç³»ã€SQLæŸ¥è¯¢

2. **è¡¨ç»“æ„å±•ç¤º**
   - ä½¿ç”¨ Collapse ç»„ä»¶æŠ˜å æ˜¾ç¤º
   - æ”¯æŒæœç´¢è¡¨å
   - å¤–é”®å­—æ®µé«˜äº®æ˜¾ç¤º
   - æ”¯æŒå¤åˆ¶è¡¨ç»“æ„DDL

3. **è¡¨å…³ç³»å±•ç¤º**
   - ä½¿ç”¨ Table ç»„ä»¶å±•ç¤ºå¤–é”®å…³ç³»
   - çº§è”è§„åˆ™ç”¨ä¸åŒé¢œè‰²çš„Tagæ ‡è¯†
   - æ”¯æŒæŒ‰è¡¨åç­›é€‰

4. **SQLæŸ¥è¯¢**
   - TextArea ä½œä¸ºSQLç¼–è¾‘å™¨
   - æ‰§è¡Œå‰å®‰å…¨æ£€æŸ¥
   - ä¿®æ”¹æ“ä½œéœ€äºŒæ¬¡ç¡®è®¤ï¼ˆModal.confirmï¼‰
   - æŸ¥è¯¢ç»“æœè¡¨æ ¼å±•ç¤º
   - æ”¯æŒå¯¼å‡ºCSV

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### ç‰¹æ®Šè¯´æ˜

æœ¬åŠŸèƒ½**ä¸åˆ›å»ºæ–°çš„ä¸šåŠ¡æ•°æ®è¡¨**ï¼Œè€Œæ˜¯æŸ¥è¯¢å’Œæ“ä½œç°æœ‰æ•°æ®åº“çš„å…ƒæ•°æ®ã€‚

### TypeScript ç±»å‹å®šä¹‰

```typescript
// è¡¨å­—æ®µä¿¡æ¯
interface TableColumn {
  cid: number;
  name: string;
  type: string;
  notNull: boolean;
  defaultValue: any;
  primaryKey: boolean;
}

// è¡¨ç»“æ„ä¿¡æ¯
interface TableInfo {
  tableName: string;
  columns: TableColumn[];
}

// å¤–é”®å…³ç³»ä¿¡æ¯
interface ForeignKeyInfo {
  childTable: string;
  childColumn: string;
  parentTable: string;
  parentColumn: string;
  onDelete: string;
  onUpdate: string;
}

// SQLæŸ¥è¯¢ç»“æœ
interface SQLQueryResult {
  columns: string[];
  values: any[][];
  rowCount: number;
  executionTime: number;
  isModifyOperation: boolean;
}
```

---

## ğŸ¨ UI/UX è®¾è®¡

### é¡µé¢å¸ƒå±€

- ä½¿ç”¨ Card ç»„ä»¶ä½œä¸ºé¡µé¢å®¹å™¨
- Tabs ç»„ä»¶å®ç°Tabé¡µåˆ‡æ¢
- æ¯ä¸ªTabé¡µç‹¬ç«‹å±•ç¤ºä¸åŒåŠŸèƒ½

### äº¤äº’è®¾è®¡

1. **è¡¨ç»“æ„æŸ¥çœ‹**
   - æŠ˜å å¼å±•ç¤ºï¼Œç‚¹å‡»å±•å¼€
   - æœç´¢æ¡†å®æ—¶è¿‡æ»¤
   - ä¸»é”®å’Œå¤–é”®é«˜äº®

2. **è¡¨å…³ç³»æŸ¥çœ‹**
   - è¡¨æ ¼å½¢å¼å±•ç¤º
   - çº§è”è§„åˆ™ç”¨é¢œè‰²æ ‡è¯†
   - æ”¯æŒç­›é€‰å’Œåˆ†é¡µ

3. **SQLæŸ¥è¯¢**
   - TextAreaç¼–è¾‘å™¨
   - æ‰§è¡ŒæŒ‰é’®å¸¦LoadingçŠ¶æ€
   - ä¿®æ”¹æ“ä½œäºŒæ¬¡ç¡®è®¤
   - æŸ¥è¯¢ç»“æœè¡¨æ ¼å±•ç¤º

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [x] èƒ½æŸ¥çœ‹æ‰€æœ‰è¡¨çš„ç»“æ„ä¿¡æ¯
- [x] èƒ½æŸ¥çœ‹æ‰€æœ‰å¤–é”®å…³ç³»
- [x] èƒ½æ‰§è¡ŒSELECTæŸ¥è¯¢å¹¶æ˜¾ç¤ºç»“æœ
- [x] UPDATE/DELETEæ“ä½œæœ‰äºŒæ¬¡ç¡®è®¤
- [x] DROP/ALTERæ“ä½œè¢«ç¦æ­¢
- [x] èƒ½å¯¼å‡ºæŸ¥è¯¢ç»“æœä¸ºCSV

### æ€§èƒ½éªŒæ”¶

- [x] è¡¨ç»“æ„åŠ è½½ < 2ç§’
- [x] è¡¨å…³ç³»åŠ è½½ < 1ç§’
- [x] SQLæŸ¥è¯¢æ‰§è¡Œ < 3ç§’

### å®‰å…¨éªŒæ”¶

- [x] ç¦æ­¢æ‰§è¡Œå±é™©DDLæ“ä½œ
- [x] ä¿®æ”¹æ“ä½œéœ€äºŒæ¬¡ç¡®è®¤
- [x] é”™è¯¯æç¤ºæ¸…æ™°å‹å¥½

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### P1 ä¼˜åŒ–é¡¹

1. **SQLç¼–è¾‘å™¨å¢å¼º**
   - å¼•å…¥ä»£ç ç¼–è¾‘å™¨ï¼ˆå¦‚ Monaco Editorï¼‰
   - æ”¯æŒSQLè¯­æ³•é«˜äº®
   - æ”¯æŒSQLè‡ªåŠ¨è¡¥å…¨

2. **æŸ¥è¯¢å†å²åŠŸèƒ½**
   - ä¿å­˜æœ€è¿‘æ‰§è¡Œçš„SQL
   - æ”¯æŒå†å²è®°å½•å¿«é€Ÿè°ƒç”¨
   - æ”¯æŒæ”¶è—å¸¸ç”¨SQL

3. **è¡¨å…³ç³»å¯è§†åŒ–**
   - ä½¿ç”¨å›¾å½¢åŒ–æ–¹å¼å±•ç¤ºERå›¾
   - æ”¯æŒäº¤äº’å¼æµè§ˆè¡¨å…³ç³»

### P2 ä¼˜åŒ–é¡¹

1. **æ•°æ®ç¼–è¾‘åŠŸèƒ½**
   - åœ¨çº¿ç¼–è¾‘è¡¨æ•°æ®
   - æ”¯æŒæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤è¡Œ

2. **æ•°æ®å¯¼å…¥å¯¼å‡º**
   - æ”¯æŒå¯¼å…¥CSVæ•°æ®åˆ°è¡¨
   - æ”¯æŒæ‰¹é‡å¯¼å‡ºè¡¨æ•°æ®

3. **æ•°æ®åº“å¤‡ä»½è¿˜åŸ**
   - ä¸€é”®å¤‡ä»½æ•°æ®åº“
   - ä¸€é”®è¿˜åŸæ•°æ®åº“

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### è®¿é—®æ–¹å¼

1. é€šè¿‡èœå•ï¼šå·¥å…·ç±» â†’ æ•°æ®åº“ç®¡ç†
2. ç›´æ¥è®¿é—®ï¼š`http://localhost:8000/tools/database`

### ä½¿ç”¨åœºæ™¯

1. **æŸ¥çœ‹è¡¨ç»“æ„**
   - è¿›å…¥"è¡¨ç»“æ„"Tabé¡µ
   - æµè§ˆæ‰€æœ‰è¡¨çš„åˆ—è¡¨
   - ç‚¹å‡»å±•å¼€æŸ¥çœ‹è¯¦ç»†å­—æ®µä¿¡æ¯

2. **æŸ¥çœ‹è¡¨å…³ç³»**
   - è¿›å…¥"è¡¨å…³ç³»"Tabé¡µ
   - æŸ¥çœ‹å¤–é”®å…³ç³»åˆ—è¡¨
   - äº†è§£çº§è”åˆ é™¤è§„åˆ™

3. **æ‰§è¡ŒSQLæŸ¥è¯¢**
   - è¿›å…¥"SQLæŸ¥è¯¢"Tabé¡µ
   - è¾“å…¥SQLè¯­å¥
   - ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®
   - æŸ¥çœ‹æŸ¥è¯¢ç»“æœ

4. **å¯¼å‡ºæŸ¥è¯¢ç»“æœ**
   - æ‰§è¡ŒæŸ¥è¯¢å
   - ç‚¹å‡»"å¯¼å‡ºCSV"æŒ‰é’®
   - ä¸‹è½½CSVæ–‡ä»¶

---

## ğŸ› å·²çŸ¥é—®é¢˜

æ— 

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [SQLite PRAGMAå‘½ä»¤æ–‡æ¡£](https://www.sqlite.org/pragma.html)
- [sql.jsä½¿ç”¨æ–‡æ¡£](https://sql.js.org/documentation/)
- [Ant Designç»„ä»¶æ–‡æ¡£](https://ant.design/components/overview/)

---

## ğŸ“… é‡Œç¨‹ç¢‘

| æ—¥æœŸ | é‡Œç¨‹ç¢‘ |
|-----|--------|
| 2025-01-15 | å®ŒæˆPRDæ–‡æ¡£ç¼–å†™ |
| 2025-01-15 | å®Œæˆæ•°æ®åº“å·¥å…·å‡½æ•°æ‰©å±• |
| 2025-01-15 | å®Œæˆå‰ç«¯é¡µé¢å¼€å‘ |
| 2025-01-15 | å®ŒæˆåŠŸèƒ½æµ‹è¯• |

---

## ğŸ‘¥ å›¢é˜Ÿæˆå‘˜

| è§’è‰² | æˆå‘˜ |
|-----|------|
| **äº§å“ç»ç†** | [å¾…å¡«å†™] |
| **å¼€å‘å·¥ç¨‹å¸ˆ** | AI Assistant |
| **æµ‹è¯•å·¥ç¨‹å¸ˆ** | [å¾…å¡«å†™] |

---

**åŠŸèƒ½çŠ¶æ€**: âœ… å¼€å‘å®Œæˆ  
**åŠŸèƒ½ç‚¹ID**: VL-TOOL-001  
**æœ€åæ›´æ–°**: 2025-01-15

