# PRD: VL用户列表管理

## 文档信息

- **功能点 ID**: VL-USR-003
- **产品模块**: 基础数据 > VL用户管理
- **创建日期**: 2025-01-15
- **创建人**: 产品团队
- **当前版本**: v1.0
- **最后更新**: 2025-01-15
- **文档状态**: 待评审

## 1. 背景与目标 (Background & Objectives)

### 1.1 业务背景

VL(VisionLine)用户是使用中枢业务平台的核心用户群体。运营人员需要统一管理这些用户的账号信息、签约状态、财务信息等。当前缺少一个集中的用户列表管理界面,导致用户信息分散,查询和管理效率低下。

### 1.2 目标用户

- **主要用户**: 运营人员、客服人员
- **次要用户**: 管理员、财务人员

### 1.3 核心目标

1. **集中管理**: 在一个页面集中展示所有 VL 用户信息,查询效率提升 80%
2. **快速检索**: 支持多维度搜索筛选,单次查询时间 < 2 秒
3. **便捷操作**: 支持账号详情查看、管理、冻结等操作,单个操作 ≤ 3 步
4. **数据导出**: 支持批量导出用户数据,用于数据分析和报表生成

## 2. 用户故事 (User Stories)

### Story 1: 查看 VL 用户列表

- **作为** 运营人员
- **我想要** 查看所有 VL 用户的列表信息
- **以便于** 了解用户整体情况和快速定位目标用户
- **优先级**: 🔴 P0

**验收条件**:
- 列表展示所有关键信息(VLID、邮箱、联系人、手机号、签约状态等)
- 支持分页展示,每页 10/20/50 条可选
- 加载时间 < 2 秒

### Story 2: 搜索和筛选用户

- **作为** 运营人员
- **我想要** 通过 VLID、签约信息、授权状态等条件搜索用户
- **以便于** 快速找到目标用户
- **优先级**: 🔴 P0

**验收条件**:
- 支持 VLID 精确搜索
- 支持签约信息模糊搜索
- 支持授权状态筛选
- 搜索结果实时更新

### Story 3: 查看用户详情

- **作为** 运营人员
- **我想要** 查看用户的详细信息
- **以便于** 了解用户的完整资料
- **优先级**: 🔴 P0

**验收条件**:
- 点击"详情"按钮打开详情弹框
- 展示所有用户字段信息
- 信息分类展示(基本信息、签约信息、财务信息、入驻信息等)

### Story 4: 管理用户账号

- **作为** 运营人员
- **我想要** 管理用户账号(编辑、冻结等)
- **以便于** 维护用户账号状态
- **优先级**: 🟡 P1

**验收条件**:
- 点击"管理"按钮打开管理弹框
- 可以编辑部分用户信息
- 可以冻结/解冻账号

### Story 5: 导出用户数据

- **作为** 运营人员
- **我想要** 导出用户列表数据
- **以便于** 进行数据分析和生成报表
- **优先级**: 🟡 P1

**验收条件**:
- 点击"数据导出"按钮
- 导出当前筛选条件下的所有用户数据
- 支持 Excel 格式导出

## 3. 功能需求 (Functional Requirements)

### 3.1 功能点 1: 用户列表展示

- **功能描述**: 以表格形式展示所有 VL 用户信息
- **输入**: 无(自动加载)
- **处理**: 
  - 调用 API 获取用户列表
  - 分页展示数据
  - 支持排序
- **输出**: 展示用户列表表格
- **异常处理**: 
  - 加载失败:提示"加载失败,请刷新重试"
  - 无数据:显示空状态提示

**列表字段**:
1. VLID - 用户唯一标识
2. 专属Token - 用户专属令牌(可复制)
3. 注册主体 - 注册的公司/个人名称
4. 注册时间 - 账号创建时间
5. 认领时间 - 认领账号的时间
6. 认领状态 - 已认领/未认领
7. 认证状态 - 已认证/未认证
8. 状态 - 使用中/已冻结/已禁用
9. 操作 - 详情、管理、冻结按钮

### 3.2 功能点 2: 搜索和筛选

- **功能描述**: 支持多维度搜索和筛选用户
- **输入**: 
  - VLID(精确搜索)
  - 签约信息(模糊搜索)
  - 授权状态(下拉选择)
- **处理**:
  - 实时搜索(输入后自动触发)
  - 多条件组合搜索
  - 重置搜索条件
- **输出**: 符合条件的用户列表
- **异常处理**: 
  - 无搜索结果:显示"暂无数据"
  - 搜索超时:提示重试

### 3.3 功能点 3: 用户详情查看

- **功能描述**: 查看用户完整详细信息
- **输入**: 用户 VLID
- **处理**:
  - 调用详情 API
  - 在 Modal 弹框中展示
  - 信息分组展示
- **输出**: 详情弹框
- **异常处理**: 
  - 加载失败:提示错误并提供重试

**详情包含信息**:
- 基本信息: VLID、注册邮箱、联系人、手机号、客户来源
- 签约信息: 签约主体、签约销售、签约邮箱
- 财务信息: 钱包状态、余额
- 入驻信息: 负责销售、负责 AE

### 3.4 功能点 4: 用户管理

- **功能描述**: 管理用户账号状态和信息
- **输入**: 用户 VLID
- **处理**:
  - 打开管理弹框
  - 支持编辑部分字段
  - 支持冻结/解冻账号
- **输出**: 管理弹框
- **异常处理**: 
  - 权限不足:提示无权限
  - 操作失败:显示具体错误

### 3.5 功能点 5: 添加账号

- **功能描述**: 新增 VL 用户账号
- **输入**: 
  - 注册邮箱(必填)
  - 联系人(必填)
  - 手机号(必填)
  - 注册主体(必填)
  - 其他信息(选填)
- **处理**:
  - 打开添加账号弹框
  - 表单校验
  - 提交创建
- **输出**: 创建成功后刷新列表
- **异常处理**: 
  - 邮箱已存在:提示重复
  - 手机号格式错误:提示修正

### 3.6 功能点 6: 数据导出

- **功能描述**: 导出用户列表数据
- **输入**: 当前筛选条件
- **处理**:
  - 生成 Excel 文件
  - 包含所有列表字段
  - 触发下载
- **输出**: Excel 文件下载
- **异常处理**: 
  - 导出失败:提示重试
  - 数据量过大:提示分批导出

## 4. 交互流程 (User Flow)

### 4.1 主流程 - 查看用户列表

1. 用户进入"VL用户列表"页面
2. 系统自动加载用户列表(第一页,每页10条)
3. 显示列表数据和分页器
4. 用户可以:
   - 点击分页器切换页面
   - 点击列表操作按钮(详情/管理/冻结)
   - 使用搜索功能

### 4.2 主流程 - 搜索用户

1. 用户在搜索框输入条件(VLID/签约信息/授权状态)
2. 系统实时触发搜索
3. 列表刷新显示搜索结果
4. 用户可以点击"重置"清空搜索条件

### 4.3 主流程 - 查看详情

1. 用户点击某行的"详情"按钮
2. 系统打开详情 Modal 弹框
3. 系统调用详情 API 加载数据
4. 详情弹框展示完整信息
5. 用户查看完毕后点击"关闭"

### 4.4 主流程 - 添加账号

1. 用户点击"添加账号"按钮
2. 系统打开添加账号 Modal 弹框
3. 用户填写表单信息
4. 用户点击"确定"提交
5. 系统校验数据
   - 校验通过 → 进入步骤 6
   - 校验失败 → 显示错误提示,返回步骤 3
6. 系统调用创建 API
7. API 返回结果
   - 成功 → 提示成功,关闭弹框,刷新列表
   - 失败 → 显示错误提示

### 4.5 主流程 - 数据导出

1. 用户点击"数据导出"按钮
2. 系统根据当前筛选条件导出数据
3. 系统生成 Excel 文件
4. 触发浏览器下载

### 4.6 异常流程

#### 场景1: 数据加载失败

- **触发条件**: API 调用失败
- **系统行为**: 显示错误提示"加载失败,请刷新重试"
- **用户操作**: 点击刷新按钮重新加载

#### 场景2: 权限不足

- **触发条件**: 用户没有操作权限
- **系统行为**: 禁用相关按钮或提示"权限不足"
- **用户操作**: 联系管理员

#### 场景3: 冻结账号确认

- **触发条件**: 用户点击"冻结"按钮
- **系统行为**: 弹出二次确认对话框
- **用户操作**: 确认或取消

## 5. UI 原型 (UI Wireframes)

### 5.1 页面结构

- **页面类型**: 列表页
- **布局方式**: 卡片 + 表格布局
- **核心组件**: Card / Table / Modal / Form / Input / Select / Button

### 5.2 列表字段定义

| 字段名称 | 字段类型 | 宽度 | 说明 |
|---------|---------|------|------|
| VLID | Text | 80px | 用户唯一标识 |
| 专属Token | Text + Copy | 150px | 用户令牌,可复制 |
| 注册主体 | Text | 200px | 公司/个人名称 |
| 注册时间 | DateTime | 150px | 格式: YYYY-MM-DD HH:mm |
| 认领时间 | DateTime | 150px | 格式: YYYY-MM-DD HH:mm |
| 认领状态 | Tag | 100px | 已认领(绿)/未认领(灰) |
| 认证状态 | Tag | 100px | 已认证(绿)/未认证(红) |
| 状态 | Tag | 100px | 使用中(绿)/已冻结(红) |
| 操作 | Actions | 150px | 详情/管理/冻结链接 |

### 5.3 搜索区域字段定义

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| VLID | Input | ❌ 否 | 支持精确搜索 |
| 签约信息 | Input | ❌ 否 | 模糊搜索公司名称等 |
| 授权状态 | Select | ❌ 否 | 下拉选择: 全部/已授权/未授权 |

### 5.4 按钮与操作

| 按钮名称 | 位置 | 样式 | 权限要求 | 操作说明 |
|---------|------|------|---------|---------|
| 添加账号 | 页面右上角 | Primary | 创建权限 | 打开添加账号弹框 |
| 数据导出 | 页面右上角 | Default | 导出权限 | 导出当前筛选数据 |
| 展开 | 搜索区域 | Link | 无 | 展开/收起高级搜索 |
| 重置 | 搜索区域 | Default | 无 | 清空搜索条件 |
| 查询 | 搜索区域 | Primary | 无 | 触发搜索 |
| 详情 | 操作列 | Link | 查看权限 | 打开详情弹框 |
| 管理 | 操作列 | Link | 管理权限 | 打开管理弹框 |
| 冻结 | 操作列 | Link Danger | 冻结权限 | 冻结/解冻账号 |

### 5.5 原型链接

- **本地代码路径**: `src/pages/vluser/list/index.tsx`
- **相关组件**: 
  - `src/pages/vluser/components/DetailModal.tsx` (详情弹框)
  - `src/pages/vluser/components/ManageModal.tsx` (管理弹框)
  - `src/pages/vluser/components/AddModal.tsx` (添加账号弹框)

## 6. 数据定义 (Data Schema)

### 6.1 API 接口

#### 获取用户列表

| 项目 | 内容 |
|-----|------|
| 接口路径 | GET /api/vlusers |
| 请求参数 | `{ pageNum: number, pageSize: number, vlid?: string, signInfo?: string, authStatus?: string }` |
| 响应数据 | `{ code: number, message: string, data: { list: VLUser[], total: number } }` |
| 错误码 | 200: 成功, 400: 参数错误, 401: 未授权, 500: 服务器错误 |

#### 获取用户详情

| 项目 | 内容 |
|-----|------|
| 接口路径 | GET /api/vlusers/:vlid |
| 请求参数 | vlid: string |
| 响应数据 | `{ code: number, message: string, data: VLUser }` |
| 错误码 | 200: 成功, 404: 用户不存在 |

#### 创建用户

| 项目 | 内容 |
|-----|------|
| 接口路径 | POST /api/vlusers |
| 请求参数 | `{ email: string, name: string, phone: string, company: string, ... }` |
| 响应数据 | `{ code: number, message: string, data: VLUser }` |
| 错误码 | 200: 成功, 400: 参数错误, 409: 邮箱已存在 |

#### 更新用户

| 项目 | 内容 |
|-----|------|
| 接口路径 | PUT /api/vlusers/:vlid |
| 请求参数 | `{ name?: string, phone?: string, ... }` |
| 响应数据 | `{ code: number, message: string, data: VLUser }` |
| 错误码 | 200: 成功, 404: 用户不存在 |

#### 冻结/解冻用户

| 项目 | 内容 |
|-----|------|
| 接口路径 | POST /api/vlusers/:vlid/freeze |
| 请求参数 | `{ freeze: boolean }` |
| 响应数据 | `{ code: number, message: string }` |
| 错误码 | 200: 成功, 404: 用户不存在, 403: 无权限 |

#### 导出用户数据

| 项目 | 内容 |
|-----|------|
| 接口路径 | POST /api/vlusers/export |
| 请求参数 | `{ vlid?: string, signInfo?: string, authStatus?: string }` |
| 响应数据 | 文件流(Excel) |
| 错误码 | 200: 成功, 400: 参数错误 |

### 6.2 数据模型

```typescript
// VL 用户数据模型
export interface VLUser {
  vlid: string;                    // VLID
  token: string;                   // 专属 Token
  registeredEntity: string;        // 注册主体
  registeredTime: string;          // 注册时间
  claimTime?: string;              // 认领时间
  claimStatus: ClaimStatus;        // 认领状态
  certStatus: CertStatus;          // 认证状态
  status: UserStatus;              // 账号状态
  
  // 基本信息
  email: string;                   // 注册邮箱
  contactPerson: string;           // 联系人
  phone: string;                   // 手机号
  customerSource: string;          // 客户来源
  
  // 签约信息
  signCompany?: string;            // 签约主体
  signSales?: string;              // 签约销售
  signEmail?: string;              // 签约邮箱
  
  // 财务信息
  walletStatus?: string;           // 钱包状态
  balance?: number;                // 余额
  
  // 入驻信息
  responsibleSales?: string;       // 负责销售
  responsibleAE?: string;          // 负责 AE
}

// 认领状态枚举
export enum ClaimStatus {
  Claimed = 'claimed',       // 已认领
  Unclaimed = 'unclaimed',   // 未认领
}

// 认证状态枚举
export enum CertStatus {
  Certified = 'certified',     // 已认证
  Uncertified = 'uncertified', // 未认证
}

// 用户状态枚举
export enum UserStatus {
  Active = 'active',      // 使用中
  Frozen = 'frozen',      // 已冻结
  Disabled = 'disabled',  // 已禁用
}

// 列表查询参数
export interface VLUserListParams {
  pageNum: number;       // 页码
  pageSize: number;      // 每页条数
  vlid?: string;         // VLID 搜索
  signInfo?: string;     // 签约信息搜索
  authStatus?: string;   // 授权状态筛选
}

// 列表响应
export interface VLUserListResponse {
  code: number;
  message: string;
  data: {
    list: VLUser[];
    total: number;
    pageNum: number;
    pageSize: number;
  };
}
```

## 7. 业务规则 (Business Rules)

### 7.1 校验规则

1. **VLID**:
   - 格式: 5 位数字
   - 唯一性: 系统自动生成,不可重复

2. **注册邮箱**:
   - 格式: 标准邮箱格式
   - 唯一性: 不可重复
   - 必填: 是

3. **手机号**:
   - 格式: 11 位数字或国际号码格式
   - 必填: 是

4. **注册主体**:
   - 长度: 2-100 个字符
   - 必填: 是

### 7.2 权限规则

| 角色 | 查看列表 | 查看详情 | 添加 | 编辑 | 冻结 | 导出 |
|-----|---------|---------|-----|-----|-----|-----|
| 管理员 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 运营人员 | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ |
| 客服人员 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |

### 7.3 状态流转

```
[新建] → [未认领]
          ↓
       [认领] → [已认领]
                  ↓
               [认证] → [已认证]

[使用中] ⇄ [已冻结](管理员可切换)
    ↓
[已禁用](不可恢复)
```

### 7.4 冻结规则

- 冻结后用户无法登录系统
- 冻结后可以解冻恢复
- 冻结操作需要二次确认
- 冻结需要管理员权限

## 8. 非功能需求 (Non-Functional Requirements)

### 8.1 性能要求

- **列表加载时间**: < 2 秒(1000 条数据以内)
- **搜索响应时间**: < 1 秒
- **详情加载时间**: < 1 秒
- **导出速度**: 1000 条数据 < 5 秒
- **并发支持**: 支持 100+ 用户同时在线操作

### 8.2 兼容性

- **浏览器**: Chrome 90+, Safari 14+, Edge 90+, Firefox 88+
- **屏幕分辨率**: ≥ 1366x768(推荐 1920x1080)
- **移动端**: 暂不支持

### 8.3 可用性

- **操作步骤**: 关键操作步骤 ≤ 3 步
- **表格展示**: 支持固定表头,横向滚动
- **数据刷新**: 支持手动刷新
- **空状态**: 无数据时显示友好提示

### 8.4 安全性

- **数据脱敏**: 手机号中间 4 位显示为 ****
- **权限校验**: 前后端双重校验
- **操作日志**: 记录所有增删改操作
- **Token 保护**: Token 复制需要权限

## 9. 验收标准 (Acceptance Criteria)

### 9.1 功能验收

- [ ] 列表正确展示所有字段
- [ ] 分页功能正常工作
- [ ] VLID 搜索功能正确
- [ ] 签约信息搜索功能正确
- [ ] 授权状态筛选功能正确
- [ ] 详情弹框正确展示所有信息
- [ ] 添加账号功能正常
- [ ] 管理功能正常
- [ ] 冻结/解冻功能正常
- [ ] 数据导出功能正常

### 9.2 UI 验收

- [ ] 表格样式符合设计规范
- [ ] 搜索区域展开/收起正常
- [ ] 状态标签颜色正确
- [ ] 操作按钮样式正确
- [ ] Modal 弹框宽度合适
- [ ] 响应式布局正常

### 9.3 性能验收

- [ ] 列表加载时间 < 2 秒
- [ ] 搜索响应时间 < 1 秒
- [ ] 无明显的页面卡顿
- [ ] 大数据量下滚动流畅

### 9.4 异常验收

- [ ] 网络异常时显示友好提示
- [ ] 无数据时显示空状态
- [ ] 权限不足时禁用按钮
- [ ] 冻结操作有二次确认

## 10. 变更记录 (Change Log)

| 版本号 | 日期 | 变更类型 | 变更内容 | 变更人 | 评审状态 |
|-------|------|---------|---------|--------|---------|
| v1.0  | 2025-01-15 | 新增 | 初始版本,定义 VL 用户列表管理功能 | 产品团队 | 待评审 |

## 11. 附录 (Appendix)

### 11.1 相关文档

- **用户手册**: `docs/user-manual/user_manual_VL用户列表管理.md`
- **前端代码**: `src/pages/vluser/list/index.tsx`
- **类型定义**: `src/types/vluser.ts`
- **API 服务**: `src/services/vluser.ts`

### 11.2 术语表

| 术语 | 英文 | 说明 |
|-----|------|------|
| VLID | VisionLine ID | VL 用户唯一标识 |
| Token | Token | 用户专属令牌 |
| 认领 | Claim | 用户认领账号的操作 |
| 认证 | Certification | 用户身份认证 |
| BV | Business Verification | 企业认证标识 |
| BMP | Business Management Platform | 企业管理平台标识 |

---

**审核记录**

| 审核人 | 审核日期 | 审核意见 | 审核结果 |
|-------|---------|---------|---------|
| - | - | - | 待评审 |

